<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ezReeport - Désabonnement de "{{ task.name }}"</title>

    <link rel="stylesheet" href="./style.css">
  </head>

  <body>
    <h1>Désabonnement de « {{ task.name }} »</h1>

    <p>
      Vous êtes actuellement abonné au rapport <strong>« {{ task.name }} »</strong>
      avec l'adresse <strong>« {{ email }} »</strong>, voulez vous désabonner ?
    </p>

    <p>
      Ce changement sera effectif immédiatement (vous ne recevrez plus les prochains rapports) et est irréversible,
      si vous voulez vous ré-abonner, rapprochez vous de la personne responsable des rapports ezREEPORT dans votre
      institution.
    </p>

    <form id="unsub-form">
      <input type="text" name="unsubId" value="{{ unsubId }}" hidden required>
      <input type="text" name="email" value="{{ email }}" hidden required>

      <div class="d-flex">
        <input type="submit" value="Confirmer">
        <a href="https://ezmesure.couperin.org/" class="btn-cancel">
          Annuler
        </a>
      </div>
    </form>

    <div id="alert-container">
    </div>
  </body>

  <script type="module">
    import { unsubFromTask } from './index.js';

    const form = document.querySelector('#unsub-form');
    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        unsubFromTask('{{ task.id }}', form);
      })
    }
  </script>
</html>