{
  "renderer": "vega-pdf",
  "renderOptions": {
    "grid": {
      "rows": 2,
      "cols": 2
    }
  },
  "layouts": [
    {
      "fetchOptions": {
        "fetchCount": "totalCount",
        "aggs": [
          {
            "name": "consult_by_date",
            "date_histogram": {
              "field": "datetime",
              "calendar_interval": "day"
            }
          },
          {
            "name": "platforms",
            "cardinality": {
              "field": "portal"
            }
          },
          {
            "name": "min_date",
            "min": {
              "field": "datetime"
            }
          },
          {
            "name": "max_date",
            "max": {
              "field": "datetime"
            }
          }
        ]
      },
      "figures": [
        {
          "type": "metric",
          "params": {
            "labels": {
              "totalCount": {
                "text": "Consultations"
              },
              "platforms": {
                "text": "Plateformes"
              },
              "min_date": {
                "text": "Début de période",
                "format": {
                  "type": "date",
                  "params": ["dd LLL yyyy"]
                }
              },
              "max_date": {
                "text": "Fin de période",
                "format": {
                  "type": "date",
                  "params": ["dd LLL yyyy"]
                }
              }
            }
          },
          "slots": [
            0,
            1
          ]
        },
        {
          "type": "bar",
          "params": {
            "dataKey": "consult_by_date",
            "title": {
              "text": "Histogramme consultations"
            },
            "value": {
              "field": "doc_count",
              "title": "Nombre de consultations"
            },
            "label": {
              "field": "key",
              "timeUnit": "yearmonthdate",
              "title": "",
              "axis": {
                "format": "%d %b %Y"
              }
            },
            "dataLabel": {
              "format": "numeric"
            }
          },
          "slots": [
            2,
            3
          ]
        }
      ]
    },
    {
      "fetcher": "elastic",
      "fetchOptions": {
        "aggs": [
          {
            "terms": {
              "field": "rtype"
            }
          }
        ]
      },
      "figures": [
        {
          "type": "arc",
          "params": {
            "dataKey": "agg0",
            "title": {
              "text": "Camembert consultations par type"
            },
            "value": {
              "field": "doc_count"
            },
            "label": {
              "field": "key",
              "title": "Type",
              "legend": null
            },
            "dataLabel": {
              "format": "percent",
              "showLabel": true
            }
          },
          "slots": [
            0,
            2
          ]
        },
        {
          "type": "table",
          "params": {
            "dataKey": "agg0",
            "title": "Top {{length}} des consultations par type",
            "maxLength": 20,
            "columns": [
              {
                "header": "Type",
                "dataKey": "key"
              },
              {
                "header": "Nombre de consultations",
                "dataKey": "doc_count"
              }
            ]
          },
          "slots": [
            1,
            3
          ]
        }
      ]
    }
  ]
}